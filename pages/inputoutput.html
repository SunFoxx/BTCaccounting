<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../css/main.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="../js/main.js"></script>
    <title>Ввод\вывод</title>
</head>
<body>
<div class="wrapper">
    <div class="header">
        Ввод\вывод
    </div>
    <form method="post" id="post_form">
        <div class="input_block">
            <label for="direction">Операция</label>
            <select name="direction" id="direction">
                <option value="input">Ввод</option>
                <option value="output">Вывод</option>
            </select>
        </div>
        <div class="input_block">
            <label for="amount">Сумма</label>
            <input type="number" name="amount_before" id="amount_before" required step="0.00000001" min="0">
        </div>
        <div class="input_block">
            <label for="currency">Валюта резерва</label>
            <select name="currency" id="currency" onchange="fillSelect(document.getElementById('paym'), defineReservesSet('currency'))">
                <option value="RUB">RUB</option>
                <option value="BTC">BTC</option>
            </select>
        </div>
        <div class="input_block">
            <label for="comiss">Комиссия</label>
            <input type="number" name="comiss" id="comiss" step="0.01" min="0" value="0" min="0">
        </div>
        <div class="input_block">
            <label for="paym">Резерв</label>
            <select name="paym" id="paym"></select>
        </div>
        <div class="input_block">
            <label for="amount">Итого</label>
            <input type="number" name="amount" id="amount" readonly step="0.01" min="0">
        </div>
        <div class="input_block">
            <label for="description">Описание</label>
            <input type="text" name="description" id="description">
        </div>
        <div class="centered">
            <button class="button submit_button" type="submit">Отправить</button>
        </div>
    </form>
    <div>
        <a href="index.html">
            <button class="button exit_button">В меню</button>
        </a>
    </div>
</div>
</body>
</html>
<script>
    $(document).ready(function () {
        fillSelect(document.getElementById('paym'), defineReservesSet('currency'));

        $("#amount_before").on('change keydown paste input', reCount);
        $("#comiss").on('change keydown paste input', reCount);

        $("#post_form").on('submit', function (e) {
            e.preventDefault();
            $.ajax({
                url: apiServer + '/pay',
                type: 'post',
                crossDomain: true,
                data: $("#post_form").serialize(),
                success: function () {
                    alert("ok!");
                }
            });
        });
    });

    function reCount() {
        var amountValue = parseFloat($("#amount_before").val()),
            comissValue = parseFloat($("#comiss").val());
        if (isNaN(amountValue)) {
            amountValue = 0;
        }
        if (isNaN(comissValue)) {
            comissValue = 0;
        }
        var result = amountValue - comissValue;
        console.log(result);
        $("#amount").val(result.toFixed(2));
    }
</script>
