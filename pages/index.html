<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../css/main.css">
    <title>Login page</title>
    <script src="../js/vendor/jquery-3.2.1.min.js"></script>
    <script src="../js/main.js"></script>
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
    <link rel="icon" href="../favicon.ico" type="image/x-icon">
</head>
<body>
<div class="wrapper">
    <form id="loginform">
        <div class="input_block middle">
            <input type="text" placeholder="username" name="login" id="login">
        </div>
        <div class="input_block middle">
            <input type="password" placeholder="password" name="password" id="password">
        </div>
        <div class="centered">
            <div id="loading_bar"></div>
            <button class="button submit_button" type="submit" id="submit">Login</button>
        </div>
    </form>
</div>
</body>
</html>

<script>
    $(document).ready(function () {
        localStorage.setItem('token', null);
        localStorage.setItem('username', null);
        localStorage.setItem('permission', null);
    });
    $("#submit").click(function () {
        $("#submit").hide();
        $("#loading_bar").html("<img src='../img/ajax-load.gif' width='10%'>");

        $("#loginform").on('submit', function (e) {
            e.preventDefault();
            $.ajax({
                url : apiServer + '/auth',
                type : 'post',
                crossDomain : true,
                data : $("#loginform").serialize(),
                success : function (data) {
                    if (Object.keys(data).length >= 2) {
                        localStorage.setItem('username', $("#login").val());
                        localStorage.setItem('token', data.token.replace(/"/g, ""));
                        localStorage.setItem('permission', data.privilege);
                        window.location = "menu.html"
                    } else {
                        $("#loading_bar").text("Something went wrong, contact the administrator");
                        $("#submit").show();
                        document.getElementById('loginform').reset();
                    }
                },
                error: function () {
                    $("#loading_bar").text("Wrong login/password, try again");
                    $("#submit").show();
                }
            });
        });
    });
</script>
