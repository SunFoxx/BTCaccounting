<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../css/main.css">
    <title>Login page</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="../js/main.js"></script>
</head>
<body>
<div class="wrapper">
    <form id="loginform">
        <div class="input_block middle">
            <input type="text" placeholder="username" name="login" id="login">
        </div>
        <div class="input_block middle">
            <input type="password" placeholder="password" name="password" id="password">
        </div>
        <div class="centered">
            <div id="loading_bar"></div>
            <button class="button submit_button" type="submit" id="submit">Login</button>
        </div>
    </form>
</div>
</body>
</html>

<script>
    $(document).ready(function () {
        sessionStorage.setItem('token', null);
        sessionStorage.setItem('username', null);
        sessionStorage.setItem('permission', null);
    });
    $("#submit").click(function () {
        $("#submit").hide();
        $("#loading_bar").html("<img src='../img/ajax-load.gif' width='10%'>");

        $("#loginform").on('submit', function (e) {
            e.preventDefault();
            $.ajax({
                url : apiServer + '/auth',
                type : 'post',
                crossDomain : true,
                data : $("#loginform").serialize(),
                success : function (data) {
                    if (data.length > 50) {
                        var parsedData = data.split(' ');
                        sessionStorage.setItem('username', $("#login").val());
                        sessionStorage.setItem('token', parsedData[0].replace(/"/g, ""));
                        sessionStorage.setItem('permission', parsedData[1]);
                        window.location = "menu.html"
                    } else {
                        $("#loading_bar").text("Wrong login/password, try again");
                        $("#submit").show();
                        document.getElementById('loginform').reset();
                    }
                },
                error: function () {
                    $("#loading_bar").text("Something went wrong, contact the administrator");
                    $("#submit").show();
                }
            });
        });
    });
</script>
